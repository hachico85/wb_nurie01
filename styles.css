* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }
body { font-family: "Noto Sans JP", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; color: #222; background: #f7f7f9; }

.topbar { position: sticky; top: 0; display: flex; gap: 12px; align-items: center; padding: 10px 14px; background: #ffffffcc; backdrop-filter: blur(6px); border-bottom: 1px solid #e6e6ef; z-index: 10; }
.app-title { margin: 0 4px 0 0; font-size: 18px; font-weight: 700; }
.tabs { display: flex; gap: 6px; }
.tab { border: 1px solid #d6d7e0; background: #fff; padding: 6px 10px; border-radius: 8px; cursor: pointer; }
.tab.active { background: #3b82f6; color: #fff; border-color: #3b82f6; }
.spacer { flex: 1; }

.tools { display: flex; align-items: center; gap: 12px; }
.tool { display: inline-flex; align-items: center; gap: 6px; font-size: 13px; color: #444; }
.palette { display: inline-flex; gap: 6px; align-items: center; padding-left: 4px; }
.swatch { width: 22px; height: 22px; border-radius: 999px; border: 2px solid #e5e7eb; cursor: pointer; display: inline-block; padding: 0; background: transparent; }
.swatch[aria-pressed="true"] { box-shadow: 0 0 0 3px rgba(59,130,246,0.25); border-color: #3b82f6; }
.buttons { display: inline-flex; gap: 6px; }
.buttons button { border: 1px solid #d6d7e0; background: #fff; padding: 6px 10px; border-radius: 8px; cursor: pointer; }
.buttons .primary[aria-pressed="true"], .buttons button[aria-pressed="true"] { background: #10b981; border-color: #10b981; color: #fff; }

.main { display: grid; grid-template-columns: 1fr; gap: 0; }
.stage { display: grid; place-items: center; padding: 16px; }

.canvas-wrap { position: relative; width: min(95vw, 980px); height: min(70vh, 720px); background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.canvas-layer { position: absolute; inset: 0; width: 100%; height: 100%; touch-action: none; }
#paintLayer { z-index: 1; }
#lineArtLayer { z-index: 2; pointer-events: none; }

.nav-arrows { position: absolute; inset: 0; display: flex; align-items: center; justify-content: space-between; padding: 0 8px; pointer-events: none; }
.nav-btn { pointer-events: auto; border: 1px solid #d6d7e0; background: #ffffffcc; padding: 6px 10px; border-radius: 999px; cursor: pointer; }

.drawer { position: fixed; right: 12px; top: 64px; width: min(420px, 90vw); max-height: calc(100vh - 80px); background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: none; flex-direction: column; overflow: hidden; z-index: 20; }
.drawer[aria-hidden="false"] { display: flex; }
.drawer-header { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-bottom: 1px solid #f0f1f5; }
.thumb-grid { padding: 12px; display: grid; grid-template-columns: repeat(auto-fill, minmax(96px, 1fr)); gap: 10px; overflow: auto; }
.thumb { display: block; border: 2px solid #e5e7eb; border-radius: 10px; padding: 4px; background: #fff; cursor: pointer; }
.thumb.active { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }
.thumb img { display: block; width: 100%; height: 100%; object-fit: contain; }

/* Screen management */
.screen { min-height: calc(100vh - 64px); }
.menu-screen, .thumb-screen { display: flex; align-items: center; justify-content: center; padding: 20px; }
.paint-screen { display: flex; flex-direction: column; }

/* Menu screen */
.menu-container { text-align: center; max-width: 600px; width: 100%; }
.menu-title { font-size: 28px; font-weight: 700; color: #333; margin-bottom: 40px; letter-spacing: 0.02em; }
.category-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 20px; }
.category-btn { 
  border: 2px solid #e5e7eb; 
  background: #fff; 
  padding: 30px 20px; 
  border-radius: 20px; 
  cursor: pointer; 
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.category-btn:hover { transform: translateY(-4px); box-shadow: 0 8px 15px rgba(0,0,0,0.15); border-color: #3b82f6; }
.category-icon { font-size: 48px; margin-bottom: 10px; }
.category-btn span { display: block; font-size: 18px; font-weight: 600; color: #374151; letter-spacing: 0.01em; }

/* Thumbnail screen */
.thumb-container { max-width: 1000px; width: 100%; }
.thumb-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; padding: 0 10px; }
.thumb-title { 
  font-size: 20px; 
  font-weight: 600;
  color: #374151; 
  margin: 0;
  letter-spacing: 0.01em;
}
.back-btn { 
  border: 1px solid #d6d7e0; 
  background: #fff; 
  padding: 10px 16px; 
  border-radius: 12px; 
  cursor: pointer;
  font-size: 14px;
  color: #374151;
}
.back-btn:hover { background: #f9fafb; }
.thumb-grid { 
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
  gap: 20px; 
}
.thumb { 
  display: block; 
  border: 3px solid #e5e7eb; 
  border-radius: 16px; 
  padding: 8px; 
  background: #fff; 
  cursor: pointer; 
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.thumb:hover { transform: translateY(-4px); box-shadow: 0 8px 15px rgba(0,0,0,0.15); border-color: #3b82f6; }
.thumb img { display: block; width: 100%; height: 200px; object-fit: contain; border-radius: 8px; }

/* Paint screen */
.paint-header { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
  padding: 15px 20px; 
  background: #fff; 
  border-bottom: 1px solid #e5e7eb;
}
.paint-nav { display: flex; align-items: center; gap: 15px; }
.paint-nav button { 
  border: 1px solid #d6d7e0; 
  background: #fff; 
  padding: 8px 12px; 
  border-radius: 8px; 
  cursor: pointer; 
}
.paint-nav button:disabled { opacity: 0.5; cursor: not-allowed; }
#paintTitle { font-size: 16px; font-weight: 600; color: #374151; }

/* Paint tools */
.paint-tools {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 20px;
  background: #f9fafb;
  border-bottom: 1px solid #e5e7eb;
  flex-wrap: wrap;
}
.paint-tools .tool { 
  display: inline-flex; 
  align-items: center; 
  gap: 6px; 
  font-size: 13px; 
  color: #444; 
}
.paint-tools .palette { 
  display: inline-flex; 
  gap: 6px; 
  align-items: center; 
}
.paint-tools .swatch { 
  width: 22px; 
  height: 22px; 
  border-radius: 999px; 
  border: 2px solid #e5e7eb; 
  cursor: pointer; 
  display: inline-block; 
  padding: 0; 
  background: transparent; 
}
.paint-tools .swatch[aria-pressed="true"] { 
  box-shadow: 0 0 0 3px rgba(59,130,246,0.25); 
  border-color: #3b82f6; 
}
.paint-tools .buttons { 
  display: inline-flex; 
  gap: 6px; 
}
.paint-tools .buttons button { 
  border: 1px solid #d6d7e0; 
  background: #fff; 
  padding: 6px 10px; 
  border-radius: 8px; 
  cursor: pointer; 
}
.paint-tools .buttons .primary[aria-pressed="true"], 
.paint-tools .buttons button[aria-pressed="true"] { 
  background: #10b981; 
  border-color: #10b981; 
  color: #fff; 
}

/* Canvas adjustments for paint screen */
.paint-screen .canvas-wrap { 
  flex: 1; 
  margin: 20px; 
  max-height: calc(100vh - 180px);
}

/* Loading animations */
.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f3f4f6;
  border-left: 4px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 16px;
}

.loading-text {
  font-size: 16px;
  font-weight: 600;
  color: #6b7280;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.thumb-loading {
  position: relative;
  min-height: 200px;
}

.thumb-skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading-shimmer 1.5s infinite;
  border-radius: 16px;
  height: 200px;
  border: 3px solid #e5e7eb;
  padding: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

/* Progressive loading styles */
.thumb-loading {
  position: relative;
}

.thumb-placeholder {
  width: 100%;
  height: 184px; /* Same as thumb img height minus padding */
  background: linear-gradient(90deg, #f8f9fa 25%, #e9ecef 50%, #f8f9fa 75%);
  background-size: 200% 100%;
  animation: loading-shimmer 1.5s infinite;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #adb5bd;
  font-size: 14px;
}

.thumb-placeholder::before {
  content: "ðŸ“·";
  font-size: 24px;
  opacity: 0.5;
}

.thumb-error {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 184px;
  background: #f8f9fa;
  border-radius: 8px;
  font-size: 24px;
  color: #dc3545;
}

@keyframes loading-shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@media (max-width: 680px) {
  .tools { flex-wrap: wrap; }
  .canvas-wrap { height: min(60vh, 640px); }
  .category-buttons { grid-template-columns: 1fr; }
  .thumb-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
  .thumb img { height: 150px; }
  .menu-title { font-size: 24px; }
  .paint-header { padding: 10px 15px; }
  .paint-screen .canvas-wrap { margin: 15px; }
  
  /* Mobile responsive for thumb title */
  .thumb-header { flex-direction: column; gap: 15px; margin-bottom: 20px; }
  .thumb-title { 
    font-size: 18px;
  }
}
